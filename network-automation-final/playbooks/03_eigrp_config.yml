---
- name: Configure EIGRP Routing
  hosts: routers
  gather_facts: no
  
  tasks:
    - name: Create loopback interfaces on R1
      cisco.ios.ios_config:
        lines:
          - ip address {{ item.ip }} 255.255.255.255
          - description Loopback for EIGRP
        parents: interface Loopback{{ item.number }}
      loop:
        - { number: 1, ip: 1.1.1.1 }
        - { number: 2, ip: 1.1.1.2 }
        - { number: 3, ip: 1.1.1.3 }
      when: inventory_hostname == 'R1'

    - name: Create loopback interfaces on R2
      cisco.ios.ios_config:
        lines:
          - ip address {{ item.ip }} 255.255.255.255
          - description Loopback for EIGRP
        parents: interface Loopback{{ item.number }}
      loop:
        - { number: 1, ip: 2.2.2.1 }
        - { number: 2, ip: 2.2.2.2 }
        - { number: 3, ip: 2.2.2.3 }
      when: inventory_hostname == 'R2'

    - name: Configure EIGRP on R1
      cisco.ios.ios_config:
        lines:
          - network 192.168.100.0 0.0.0.255
          - network 1.1.1.1 0.0.0.0
          - network 1.1.1.2 0.0.0.0
          - network 1.1.1.3 0.0.0.0
          - no auto-summary
        parents: router eigrp 100
      when: inventory_hostname == 'R1'

    - name: Configure EIGRP on R2
      cisco.ios.ios_config:
        lines:
          - network 192.168.100.0 0.0.0.255
          - network 2.2.2.1 0.0.0.0
          - network 2.2.2.2 0.0.0.0
          - network 2.2.2.3 0.0.0.0
          - no auto-summary
        parents: router eigrp 100
      when: inventory_hostname == 'R2'

    - name: Save configuration
      cisco.ios.ios_config:
        save_when: always

    - name: Wait for EIGRP to converge
      ansible.builtin.pause:
        seconds: 15

    - name: Verify EIGRP neighbors
      cisco.ios.ios_command:
        commands:
          - show ip eigrp neighbors
      register: eigrp_neighbors

    - name: Display EIGRP neighbors
      ansible.builtin.debug:
        var: eigrp_neighbors.stdout_lines

    - name: Verify EIGRP routing table
      cisco.ios.ios_command:
        commands:
          - show ip route eigrp
      register: eigrp_routes

    - name: Display EIGRP routes
      ansible.builtin.debug:
        var: eigrp_routes.stdout_lines

    - name: Display success message
      ansible.builtin.debug:
        msg: "âœ“ EIGRP configured on {{ inventory_hostname }} with loopbacks Lo1, Lo2, Lo3"