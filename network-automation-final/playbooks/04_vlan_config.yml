---
- name: Configure VLANs on Switch
  hosts: switches
  gather_facts: no

  tasks:
    - name: Create VLAN 10 (Data)
      cisco.ios.ios_config:
        lines:
          - name Data
        parents: vlan 10

    - name: Create VLAN 20 (Voice)
      cisco.ios.ios_config:
        lines:
          - name Voice
        parents: vlan 20

    - name: Create VLAN 99 (Management)
      cisco.ios.ios_config:
        lines:
          - name Management
        parents: vlan 99

    - name: Configure trunk port fa0/1 to R1
      cisco.ios.ios_config:
        lines:
          - description Trunk to R1
          - switchport mode trunk
          - switchport trunk allowed vlan 10,20,99
          - no shutdown
        parents: interface FastEthernet0/1

    - name: Configure trunk port fa0/2 to R2
      cisco.ios.ios_config:
        lines:
          - description Trunk to R2
          - switchport mode trunk
          - switchport trunk allowed vlan 10,20,99
          - no shutdown
        parents: interface FastEthernet0/2

    - name: Assign access ports to VLANs (optional)
      cisco.ios.ios_config:
        lines:
          - switchport mode access
          - switchport access vlan {{ item.vlan }}
          - description {{ item.description }}
          - no shutdown
        parents: interface {{ item.interface }}
      loop:
        - { interface: 'FastEthernet0/5', vlan: 10, description: 'Data VLAN Port' }
        - { interface: 'FastEthernet0/6', vlan: 20, description: 'Voice VLAN Port' }
        - { interface: 'FastEthernet0/7', vlan: 99, description: 'Management VLAN Port' }
      failed_when: false

    - name: Save configuration
      cisco.ios.ios_config:
        save_when: always

    - name: Verify VLANs created
      cisco.ios.ios_command:
        commands:
          - show vlan brief
      register: vlan_output

    - name: Display VLAN configuration
      ansible.builtin.debug:
        var: vlan_output.stdout_lines

    - name: Verify trunk ports
      cisco.ios.ios_command:
        commands:
          - show interfaces trunk
      register: trunk_output

    - name: Display trunk configuration
      ansible.builtin.debug:
        var: trunk_output.stdout_lines

    - name: Display success message
      ansible.builtin.debug:
        msg: "âœ“ VLANs configured: Data (10), Voice (20), Management (99) with trunk ports to routers"