---
- name: Configure VLANs on Switch
  hosts: switches
  gather_facts: no
  vars:
    ansible_command_timeout: 120

  tasks:
    - name: Create VLAN 10 (Data)
      cisco.ios.ios_config:
        lines:
          - name Data
        parents: vlan 10
      timeout: 120

    - name: Create VLAN 20 (Voice)
      cisco.ios.ios_config:
        lines:
          - name Voice
        parents: vlan 20
      timeout: 120

    - name: Create VLAN 99 (Management)
      cisco.ios.ios_config:
        lines:
          - name Management
        parents: vlan 99
      timeout: 120

    - name: Configure trunk port on fa0/3
      cisco.ios.ios_config:
        lines:
          - description Trunk Port
          - switchport mode trunk
          - switchport trunk allowed vlan 10,20,99
          - no shutdown
        parents: interface FastEthernet0/3
      timeout: 120
      failed_when: false

    - name: Save configuration
      cisco.ios.ios_config:
        save_when: always
      timeout: 120

    - name: Verify VLANs created
      cisco.ios.ios_command:
        commands:
          - show vlan brief
      register: vlan_output

    - name: Display VLAN configuration
      ansible.builtin.debug:
        var: vlan_output.stdout_lines

    - name: Display success message
      ansible.builtin.debug:
        msg: "âœ“ VLANs configured: Data (10), Voice (20), Management (99) with trunk port on fa0/3"